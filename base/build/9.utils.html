<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>配置 loader | webpack笔记</title>
    <meta name="description" content="个人总结的vuepress学习技术文档-语法">
    <link rel="icon" href="">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="msapplication-TileColor" content="#000000">
    <meta name="keywords" content="vuepress,最新技术文档,vuepress语法,markdown语法">
    <link rel="preload" href="/Web-Webpack/assets/css/0.styles.d37a6a5b.css" as="style"><link rel="preload" href="/Web-Webpack/assets/js/app.74e82492.js" as="script"><link rel="preload" href="/Web-Webpack/assets/js/17.cd22f392.js" as="script"><link rel="prefetch" href="/Web-Webpack/assets/js/10.b4fb89a2.js"><link rel="prefetch" href="/Web-Webpack/assets/js/100.27df2309.js"><link rel="prefetch" href="/Web-Webpack/assets/js/101.e9ca8695.js"><link rel="prefetch" href="/Web-Webpack/assets/js/102.48dee818.js"><link rel="prefetch" href="/Web-Webpack/assets/js/103.0fbfd8db.js"><link rel="prefetch" href="/Web-Webpack/assets/js/104.c5c2f36c.js"><link rel="prefetch" href="/Web-Webpack/assets/js/105.cd0fd24c.js"><link rel="prefetch" href="/Web-Webpack/assets/js/106.6619500d.js"><link rel="prefetch" href="/Web-Webpack/assets/js/107.68e820f1.js"><link rel="prefetch" href="/Web-Webpack/assets/js/108.302933b4.js"><link rel="prefetch" href="/Web-Webpack/assets/js/109.8563746a.js"><link rel="prefetch" href="/Web-Webpack/assets/js/11.3ba5f3c3.js"><link rel="prefetch" href="/Web-Webpack/assets/js/110.9a654db5.js"><link rel="prefetch" href="/Web-Webpack/assets/js/111.9cd0c8fc.js"><link rel="prefetch" href="/Web-Webpack/assets/js/112.73a10023.js"><link rel="prefetch" href="/Web-Webpack/assets/js/113.a120aeb9.js"><link rel="prefetch" href="/Web-Webpack/assets/js/114.97ea8182.js"><link rel="prefetch" href="/Web-Webpack/assets/js/115.24890147.js"><link rel="prefetch" href="/Web-Webpack/assets/js/116.4cfed9a2.js"><link rel="prefetch" href="/Web-Webpack/assets/js/117.899033cb.js"><link rel="prefetch" href="/Web-Webpack/assets/js/118.fb269ee2.js"><link rel="prefetch" href="/Web-Webpack/assets/js/119.566458c6.js"><link rel="prefetch" href="/Web-Webpack/assets/js/12.8ba00c27.js"><link rel="prefetch" href="/Web-Webpack/assets/js/120.a65c980e.js"><link rel="prefetch" href="/Web-Webpack/assets/js/121.1118dc76.js"><link rel="prefetch" href="/Web-Webpack/assets/js/122.69fd90ac.js"><link rel="prefetch" href="/Web-Webpack/assets/js/123.11bd1495.js"><link rel="prefetch" href="/Web-Webpack/assets/js/13.c07a1b6f.js"><link rel="prefetch" href="/Web-Webpack/assets/js/14.6e40fd8e.js"><link rel="prefetch" href="/Web-Webpack/assets/js/15.2cbbef7b.js"><link rel="prefetch" href="/Web-Webpack/assets/js/16.342cfabe.js"><link rel="prefetch" href="/Web-Webpack/assets/js/18.9d96e85a.js"><link rel="prefetch" href="/Web-Webpack/assets/js/19.fcffd6cf.js"><link rel="prefetch" href="/Web-Webpack/assets/js/2.d06e7133.js"><link rel="prefetch" href="/Web-Webpack/assets/js/20.4b71d4bd.js"><link rel="prefetch" href="/Web-Webpack/assets/js/21.043521fa.js"><link rel="prefetch" href="/Web-Webpack/assets/js/22.4368e094.js"><link rel="prefetch" href="/Web-Webpack/assets/js/23.4ce540ce.js"><link rel="prefetch" href="/Web-Webpack/assets/js/24.4a5bc311.js"><link rel="prefetch" href="/Web-Webpack/assets/js/25.67644d31.js"><link rel="prefetch" href="/Web-Webpack/assets/js/26.1fcb04e4.js"><link rel="prefetch" href="/Web-Webpack/assets/js/27.753fc8e2.js"><link rel="prefetch" href="/Web-Webpack/assets/js/28.25218221.js"><link rel="prefetch" href="/Web-Webpack/assets/js/29.98651ebd.js"><link rel="prefetch" href="/Web-Webpack/assets/js/3.76bc8172.js"><link rel="prefetch" href="/Web-Webpack/assets/js/30.8cc05127.js"><link rel="prefetch" href="/Web-Webpack/assets/js/31.f09ca892.js"><link rel="prefetch" href="/Web-Webpack/assets/js/32.1da73906.js"><link rel="prefetch" href="/Web-Webpack/assets/js/33.8d0e7ccb.js"><link rel="prefetch" href="/Web-Webpack/assets/js/34.90406719.js"><link rel="prefetch" href="/Web-Webpack/assets/js/35.a46c4cec.js"><link rel="prefetch" href="/Web-Webpack/assets/js/36.5d460cab.js"><link rel="prefetch" href="/Web-Webpack/assets/js/37.ec683747.js"><link rel="prefetch" href="/Web-Webpack/assets/js/38.9bf24c2e.js"><link rel="prefetch" href="/Web-Webpack/assets/js/39.c258a0a9.js"><link rel="prefetch" href="/Web-Webpack/assets/js/4.1d821435.js"><link rel="prefetch" href="/Web-Webpack/assets/js/40.038996d4.js"><link rel="prefetch" href="/Web-Webpack/assets/js/41.f9e59b87.js"><link rel="prefetch" href="/Web-Webpack/assets/js/42.9be6a42f.js"><link rel="prefetch" href="/Web-Webpack/assets/js/43.be195772.js"><link rel="prefetch" href="/Web-Webpack/assets/js/44.3dc02473.js"><link rel="prefetch" href="/Web-Webpack/assets/js/45.31aa48df.js"><link rel="prefetch" href="/Web-Webpack/assets/js/46.d3436033.js"><link rel="prefetch" href="/Web-Webpack/assets/js/47.2372fc80.js"><link rel="prefetch" href="/Web-Webpack/assets/js/48.f64d8b02.js"><link rel="prefetch" href="/Web-Webpack/assets/js/49.04bd44b9.js"><link rel="prefetch" href="/Web-Webpack/assets/js/5.f1df1563.js"><link rel="prefetch" href="/Web-Webpack/assets/js/50.45c27602.js"><link rel="prefetch" href="/Web-Webpack/assets/js/51.d518f7bd.js"><link rel="prefetch" href="/Web-Webpack/assets/js/52.fb4d3961.js"><link rel="prefetch" href="/Web-Webpack/assets/js/53.26c3c64a.js"><link rel="prefetch" href="/Web-Webpack/assets/js/54.8303bf79.js"><link rel="prefetch" href="/Web-Webpack/assets/js/55.57e5153b.js"><link rel="prefetch" href="/Web-Webpack/assets/js/56.24683b79.js"><link rel="prefetch" href="/Web-Webpack/assets/js/57.1737d4ad.js"><link rel="prefetch" href="/Web-Webpack/assets/js/58.488d9736.js"><link rel="prefetch" href="/Web-Webpack/assets/js/59.2da594f8.js"><link rel="prefetch" href="/Web-Webpack/assets/js/6.8097e893.js"><link rel="prefetch" href="/Web-Webpack/assets/js/60.a1106df2.js"><link rel="prefetch" href="/Web-Webpack/assets/js/61.a77a5338.js"><link rel="prefetch" href="/Web-Webpack/assets/js/62.9a593ea0.js"><link rel="prefetch" href="/Web-Webpack/assets/js/63.40dbd180.js"><link rel="prefetch" href="/Web-Webpack/assets/js/64.ee8ae6f1.js"><link rel="prefetch" href="/Web-Webpack/assets/js/65.cd986a6b.js"><link rel="prefetch" href="/Web-Webpack/assets/js/66.79754bcc.js"><link rel="prefetch" href="/Web-Webpack/assets/js/67.3b304349.js"><link rel="prefetch" href="/Web-Webpack/assets/js/68.614529b2.js"><link rel="prefetch" href="/Web-Webpack/assets/js/69.48ba230f.js"><link rel="prefetch" href="/Web-Webpack/assets/js/7.d52ed2a6.js"><link rel="prefetch" href="/Web-Webpack/assets/js/70.9dd9dc25.js"><link rel="prefetch" href="/Web-Webpack/assets/js/71.cb1623f9.js"><link rel="prefetch" href="/Web-Webpack/assets/js/72.ed8850f8.js"><link rel="prefetch" href="/Web-Webpack/assets/js/73.8621a7a0.js"><link rel="prefetch" href="/Web-Webpack/assets/js/74.9cbd6f19.js"><link rel="prefetch" href="/Web-Webpack/assets/js/75.2d46bc02.js"><link rel="prefetch" href="/Web-Webpack/assets/js/76.6d58a44a.js"><link rel="prefetch" href="/Web-Webpack/assets/js/77.e68d93a8.js"><link rel="prefetch" href="/Web-Webpack/assets/js/78.744a9262.js"><link rel="prefetch" href="/Web-Webpack/assets/js/79.7c4937e7.js"><link rel="prefetch" href="/Web-Webpack/assets/js/8.bb357538.js"><link rel="prefetch" href="/Web-Webpack/assets/js/80.99caca6e.js"><link rel="prefetch" href="/Web-Webpack/assets/js/81.f5ee4083.js"><link rel="prefetch" href="/Web-Webpack/assets/js/82.560882e1.js"><link rel="prefetch" href="/Web-Webpack/assets/js/83.31e210eb.js"><link rel="prefetch" href="/Web-Webpack/assets/js/84.3dbdf4e4.js"><link rel="prefetch" href="/Web-Webpack/assets/js/85.bcfc7f6c.js"><link rel="prefetch" href="/Web-Webpack/assets/js/86.9bfcc586.js"><link rel="prefetch" href="/Web-Webpack/assets/js/87.06044079.js"><link rel="prefetch" href="/Web-Webpack/assets/js/88.e84732cf.js"><link rel="prefetch" href="/Web-Webpack/assets/js/89.9375b5bb.js"><link rel="prefetch" href="/Web-Webpack/assets/js/9.4d207810.js"><link rel="prefetch" href="/Web-Webpack/assets/js/90.bf2f03c1.js"><link rel="prefetch" href="/Web-Webpack/assets/js/91.28bb6a8b.js"><link rel="prefetch" href="/Web-Webpack/assets/js/92.2464d613.js"><link rel="prefetch" href="/Web-Webpack/assets/js/93.ba4c180d.js"><link rel="prefetch" href="/Web-Webpack/assets/js/94.862deb41.js"><link rel="prefetch" href="/Web-Webpack/assets/js/95.0baade8e.js"><link rel="prefetch" href="/Web-Webpack/assets/js/96.8aaca647.js"><link rel="prefetch" href="/Web-Webpack/assets/js/97.05fb2109.js"><link rel="prefetch" href="/Web-Webpack/assets/js/98.146ab678.js"><link rel="prefetch" href="/Web-Webpack/assets/js/99.39081b1b.js">
    <link rel="stylesheet" href="/Web-Webpack/assets/css/0.styles.d37a6a5b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/Web-Webpack/" class="home-link router-link-active"><!----> <span class="site-name">webpack笔记</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">基础知识</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Web-Webpack/base/build/1.config.html" class="nav-link">1.构建基础篇</a></li><li class="dropdown-item"><!----> <a href="/Web-Webpack/base/function/skill.html" class="nav-link">2.项目功能点</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">高级知识</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Web-Webpack/senior/use/1.recursionAndDynamics.html" class="nav-link">1.组件精讲</a></li><li class="dropdown-item"><!----> <a href="/Web-Webpack/senior/typeScript.html" class="nav-link">2.TypeScript</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">源码知识</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Web-Webpack/source/vue/1.preparation.html" class="nav-link">1.vue源码解析</a></li><li class="dropdown-item"><!----> <a href="/Web-Webpack/source/vuex.html" class="nav-link">2.vuex源码解析</a></li><li class="dropdown-item"><!----> <a href="/Web-Webpack/source/vue-router.html" class="nav-link">3.vue-router源码解析</a></li><li class="dropdown-item"><!----> <a href="/Web-Webpack/source/element/Pagination.html" class="nav-link">4.element源码解析</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">基础知识</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Web-Webpack/base/build/1.config.html" class="nav-link">1.构建基础篇</a></li><li class="dropdown-item"><!----> <a href="/Web-Webpack/base/function/skill.html" class="nav-link">2.项目功能点</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">高级知识</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Web-Webpack/senior/use/1.recursionAndDynamics.html" class="nav-link">1.组件精讲</a></li><li class="dropdown-item"><!----> <a href="/Web-Webpack/senior/typeScript.html" class="nav-link">2.TypeScript</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">源码知识</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Web-Webpack/source/vue/1.preparation.html" class="nav-link">1.vue源码解析</a></li><li class="dropdown-item"><!----> <a href="/Web-Webpack/source/vuex.html" class="nav-link">2.vuex源码解析</a></li><li class="dropdown-item"><!----> <a href="/Web-Webpack/source/vue-router.html" class="nav-link">3.vue-router源码解析</a></li><li class="dropdown-item"><!----> <a href="/Web-Webpack/source/element/Pagination.html" class="nav-link">4.element源码解析</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/Web-Webpack/base/build/1.config.html" class="sidebar-link">一、webpack 的概念和基础使用</a></li><li><a href="/Web-Webpack/base/build/2.webpack.html" class="sidebar-link">webpack 如何解析代码模块路径</a></li><li><a href="/Web-Webpack/base/build/3.file.html" class="sidebar-link">创建自己的 loader</a></li><li><a href="/Web-Webpack/base/build/4.single.html" class="sidebar-link">创建自己的 plugin</a></li><li><a href="/Web-Webpack/base/build/5.page.html" class="sidebar-link">搭建基本的前端开发环境</a></li><li><a href="/Web-Webpack/base/build/7.module.html" class="sidebar-link">更好地使用 webpack-dev-server</a></li><li><a href="/Web-Webpack/base/build/8.project.html" class="sidebar-link">开发和生产环境的构建配置差异</a></li><li><a href="/Web-Webpack/base/build/9.utils.html" aria-current="page" class="active sidebar-link">配置 loader</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Web-Webpack/base/build/9.utils.html#loader-匹配规则" class="sidebar-link">loader 匹配规则</a></li><li class="sidebar-sub-header"><a href="/Web-Webpack/base/build/9.utils.html#规则条件配置" class="sidebar-link">规则条件配置</a></li><li class="sidebar-sub-header"><a href="/Web-Webpack/base/build/9.utils.html#module-type" class="sidebar-link">module type</a></li><li class="sidebar-sub-header"><a href="/Web-Webpack/base/build/9.utils.html#使用-loader-配置" class="sidebar-link">使用 loader 配置</a></li><li class="sidebar-sub-header"><a href="/Web-Webpack/base/build/9.utils.html#loader-应用顺序" class="sidebar-link">loader 应用顺序</a></li><li class="sidebar-sub-header"><a href="/Web-Webpack/base/build/9.utils.html#使用-noparse" class="sidebar-link">使用 noParse</a></li></ul></li><li><a href="/Web-Webpack/base/build/10.ui.html" class="sidebar-link">使用 plugin</a></li><li><a href="/Web-Webpack/base/build/11.data.html" class="sidebar-link">/base/build/11.data.html</a></li><li><a href="/Web-Webpack/base/build/12.skill.html" class="sidebar-link">/base/build/12.skill.html</a></li><li><a href="/Web-Webpack/base/build/13.com.html" class="sidebar-link">/base/build/13.com.html</a></li><li><a href="/Web-Webpack/base/build/14.data.html" class="sidebar-link">/base/build/14.data.html</a></li><li><a href="/Web-Webpack/base/build/15.api.html" class="sidebar-link">/base/build/15.api.html</a></li></ul> </div> <div class="page"> <div class="content"><h1 id="配置-loader"><a href="#配置-loader" class="header-anchor">#</a> 配置 loader</h1> <p>在第 1 小节，我们提到过，webpack 的 loader 用于处理不同的文件类型，在日常的项目中使用 loader 时，可能会遇到比较复杂的情况，本小节我们来深入探讨 loader 的一些配置细节。</p> <h2 id="loader-匹配规则"><a href="#loader-匹配规则" class="header-anchor">#</a> loader 匹配规则</h2> <p>当我们需要配置 loader 时，都是在 <code>module.rules</code> 中添加新的配置项，在该字段中，每一项被视为一条匹配使用 loader 的规则。</p> <p>先来看一个基础的例子：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>module.exports = {
  // ...
  module: {
    rules: [
      {
        test: /\.jsx?/, // 条件
        include: [
          path.resolve(__dirname, 'src'),
        ], // 条件
        use: 'babel-loader', // 规则应用结果
      }, // 一个 object 即一条规则
      // ...
    ],
  },
}

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>loader 的匹配规则中有两个最关键的因素：一个是匹配条件，一个是匹配规则后的应用。</p> <p>匹配条件通常都使用请求资源文件的绝对路径来进行匹配，在官方文档中称为 <code>resource</code>，除此之外还有比较少用到的 <code>issuer</code>，则是声明依赖请求的源文件的绝对路径。举个例子：在 /path/to/app.js 中声明引入 <code>import './src/style.scss'</code>，<code>resource</code> 是 /path/to/src/style.scss，<code>issuer</code> 是 /path/to/app.js，规则条件会对这两个值来尝试匹配。</p> <p>上述代码中的 <code>test</code> 和 <code>include</code> 都用于匹配 <code>resource</code> 路径，是 <code>resource.test</code> 和 <code>resource.include</code> 的简写，你也可以这么配置：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>module.exports = {
  // ...
  rules: [
      {
        resource: { // resource 的匹配条件
          test: /\.jsx?/,
          include: [
            path.resolve(__dirname, 'src'),
          ],
        },
        // 如果要使用 issuer 匹配，便是 issuer: { test: ... }
        use: 'babel-loader',
      },
      // ...
    ],
}

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><blockquote><p>issuer 规则匹配的场景比较少见，你可以用它来尝试约束某些类型的文件中只能引用某些类型的文件。</p></blockquote> <p>当规则的条件匹配时，便会使用对应的 loader 配置，如上述例子中的 <code>babel-loader</code>。关于 loader 配置后面再详细介绍，这里先来看看如何配置更加复杂的规则匹配条件。</p> <h2 id="规则条件配置"><a href="#规则条件配置" class="header-anchor">#</a> 规则条件配置</h2> <p>大多数情况下，配置 loader 的匹配条件时，只要使用 <code>test</code> 字段就好了，很多时候都只需要匹配文件后缀名来决定使用什么 loader，但也不排除在某些特殊场景下，我们需要配置比较复杂的匹配条件。webpack 的规则提供了多种配置形式：</p> <ul><li><code>{ test: ... }</code> 匹配特定条件</li> <li><code>{ include: ... }</code> 匹配特定路径</li> <li><code>{ exclude: ... }</code> 排除特定路径</li> <li><code>{ and: [...] }</code>必须匹配数组中所有条件</li> <li><code>{ or: [...] }</code> 匹配数组中任意一个条件</li> <li><code>{ not: [...] }</code> 排除匹配数组中所有条件</li></ul> <p>上述的所谓条件的值可以是：</p> <ul><li>字符串：必须以提供的字符串开始，所以是字符串的话，这里我们需要提供绝对路径</li> <li>正则表达式：调用正则的 <code>test</code> 方法来判断匹配</li> <li>函数：(path) =&gt; boolean，返回 <code>true</code> 表示匹配</li> <li>数组：至少包含一个条件的数组</li> <li>对象：匹配所有属性值的条件</li></ul> <p>通过例子来帮助理解：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>rules: [
  {
    test: /\.jsx?/, // 正则
    include: [
      path.resolve(__dirname, 'src'), // 字符串，注意是绝对路径
    ], // 数组
    // ...
  },
  {
    test: {
      js: /\.js/,
      jsx: /\.jsx/,
    }, // 对象，不建议使用
    not: [
      (value) =&gt; { /* ... */ return true; }, // 函数，通常需要高度自定义时才会使用
    ],
  },
],

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>上述多个配置形式结合起来就能够基本满足各种各样的构建场景了，通常我们会结合使用 <code>test/and</code> 和 <code>include&amp;exclude</code> 来配置条件，如上述那个简单的例子。</p> <h2 id="module-type"><a href="#module-type" class="header-anchor">#</a> module type</h2> <p>webpack 4.x 版本强化了 module type，即模块类型的概念，不同的模块类型类似于配置了不同的 loader，webpack 会有针对性地进行处理，现阶段实现了以下 5 种模块类型。</p> <ul><li><code>javascript/auto</code>：即 webpack 3 默认的类型，支持现有的各种 JS 代码模块类型 —— CommonJS、AMD、ESM</li> <li><code>javascript/esm</code>：ECMAScript modules，其他模块系统，例如 CommonJS 或者 AMD 等不支持，是 <code>.mjs</code> 文件的默认类型</li> <li><code>javascript/dynamic</code>：CommonJS 和 AMD，排除 ESM</li> <li><code>javascript/json</code>：JSON 格式数据，<code>require</code> 或者 <code>import</code> 都可以引入，是 <code>.json</code> 文件的默认类型</li> <li><code>webassembly/experimental</code>：WebAssembly modules，当前还处于试验阶段，是 <code>.wasm</code> 文件的默认类型</li></ul> <p>如果不希望使用默认的类型的话，在确定好匹配规则条件时，我们可以使用 <code>type</code> 字段来指定模块类型，例如把所有的 JS 代码文件都设置为强制使用 ESM 类型：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>{
  test: /\.js/,
  include: [
    path.resolve(__dirname, 'src'),
  ],
  type: 'javascript/esm', // 这里指定模块类型
},

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>上述做法是可以帮助你规范整个项目的模块系统，但是如果遗留太多不同类型的模块代码时，建议还是直接使用默认的 <code>javascript/auto</code>。</p> <p>webpack 后续的开发计划会增加对更多模块类型的支持，例如极其常见的 CSS 和 HTML 模块类型，这个特性值得我们期待一下。</p> <h2 id="使用-loader-配置"><a href="#使用-loader-配置" class="header-anchor">#</a> 使用 loader 配置</h2> <p>当然，在当前版本的 webpack 中，<code>module.rules</code> 的匹配规则最重要的还是用于配置 loader，我们可以使用 <code>use</code> 字段：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>rules: [
  {
    test: /\.less/,
    use: [
      'style-loader', // 直接使用字符串表示 loader
      {
        loader: 'css-loader',
        options: {
          importLoaders: 1
        },
      }, // 用对象表示 loader，可以传递 loader 配置等
      {
        loader: 'less-loader',
        options: {
          noIeCompat: true
        }, // 传递 loader 配置
      },
    ],
  },
],

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p>我们看下上述的例子，先忽略 loader 的使用情况，单纯看看如何配置。<code>use</code> 字段可以是一个数组，也可以是一个字符串或者表示 loader 的对象。如果只需要一个 loader，也可以这样：<code>use: { loader: 'babel-loader', options: { ... } }</code>。</p> <p>我们还可以使用 <code>options</code> 给对应的 loader 传递一些配置项，这里不再展开。当你使用一些 loader 时，loader 的说明一般都有相关配置的描述。</p> <h2 id="loader-应用顺序"><a href="#loader-应用顺序" class="header-anchor">#</a> loader 应用顺序</h2> <p>前面提到，一个匹配规则中可以配置使用多个 loader，即一个模块文件可以经过多个 loader 的转换处理，执行顺序是从最后配置的 loader 开始，一步步往前。例如，对于上面的 <code>less</code> 规则配置，一个 style.less 文件会途径 less-loader、css-loader、style-loader 处理，成为一个可以打包的模块。</p> <p>loader 的应用顺序在配置多个 loader 一起工作时很重要，通常会使用在 CSS 配置上，除了 style-loader 和 css-loader，你可能还要配置 less-loader 然后再加个 postcss 的 autoprefixer 等。</p> <p>上述从后到前的顺序是在同一个 rule 中进行的，那如果多个 rule 匹配了同一个模块文件，loader 的应用顺序又是怎样的呢？看一份这样的配置：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>rules: [
  {
    test: /\.js$/,
    exclude: /node_modules/,
    loader: &quot;eslint-loader&quot;,
  },
  {
    test: /\.js$/,
    exclude: /node_modules/,
    loader: &quot;babel-loader&quot;,
  },
],

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>这样无法法保证 eslint-loader 在 babel-loader 应用前执行。webpack 在 <code>rules</code> 中提供了一个 <code>enforce</code> 的字段来配置当前 rule 的 loader 类型，没配置的话是普通类型，我们可以配置 <code>pre</code> 或 <code>post</code>，分别对应前置类型或后置类型的 loader。</p> <blockquote><p>eslint-loader 要检查的是人工编写的代码，如果在 babel-loader 之后使用，那么检查的是 Babel 转换后的代码，所以必须在 babel-loader 处理之前使用。</p></blockquote> <p>还有一种行内 loader，即我们在应用代码中引用依赖时直接声明使用的 loader，如 <code>const json = require('json-loader!./file.json')</code> 这种。不建议在应用开发中使用这种 loader，后续我们还会再提到。</p> <p>顾名思义，所有的 loader 按照<strong>前置 -&gt; 行内 -&gt; 普通 -&gt; 后置</strong>的顺序执行。所以当我们要确保 eslint-loader 在 babel-loader 之前执行时，可以如下添加 <code>enforce</code> 配置：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>rules: [
  {
    enforce: 'pre', // 指定为前置类型
    test: /\.js$/,
    exclude: /node_modules/,
    loader: &quot;eslint-loader&quot;,
  },
]

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>当项目文件类型和应用的 loader 不是特别复杂的时候，通常建议把要应用的同一类型 loader 都写在同一个匹配规则中，这样更好维护和控制。</p> <h2 id="使用-noparse"><a href="#使用-noparse" class="header-anchor">#</a> 使用 <code>noParse</code></h2> <p>在 webpack 中，我们需要使用的 loader 是在 <code>module.rules</code> 下配置的，webpack 配置中的 module 用于控制如何处理项目中不同类型的模块。</p> <p>除了 <code>module.rules</code> 字段用于配置 loader 之外，还有一个 <code>module.noParse</code> 字段，可以用于配置哪些模块文件的内容不需要进行解析。对于一些<strong>不需要解析依赖（即无依赖）</strong> 的第三方大型类库等，可以通过这个字段来配置，以提高整体的构建速度。</p> <blockquote><p>使用 <code>noParse</code> 进行忽略的模块文件中不能使用 <code>import</code>、<code>require</code>、<code>define</code> 等导入机制。</p></blockquote> <div class="language- line-numbers-mode"><pre class="language-text"><code>module.exports = {
  // ...
  module: {
    noParse: /jquery|lodash/, // 正则表达式

    // 或者使用 function
    noParse(content) {
      return /jquery|lodash/.test(content)
    },
  }
}

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p><code>noParse</code> 从某种程度上说是个优化配置项，日常也可以不去使用。</p></div> <div class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新: </span> <span class="time">2020-10-25 22:03:45</span></div></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/Web-Webpack/base/build/8.project.html" class="prev">
          开发和生产环境的构建配置差异
        </a></span> <span class="next"><a href="/Web-Webpack/base/build/10.ui.html">
          使用 plugin
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/Web-Webpack/assets/js/app.74e82492.js" defer></script><script src="/Web-Webpack/assets/js/17.cd22f392.js" defer></script>
  </body>
</html>
